## Database > RDS for MySQL > Parameter Group

## Parameter Group

To apply the settings of MySQL installed on a DB instance, RDS for MySQL provides the parameter group feature. A parameter group is a set of parameters for which you can set MySQL. When the service is enabled, the default parameter group is provided for each DB engine version. The default parameter group is provided by `default.{DB Engine Version Name}` and is configured with the recommended default parameter values for each version. Default parameter group can be modified and deleted the same
as other parameter groups.

### Create Parameter Group

You can create parameter groups in the parameter console when needed. Parameter groups are created by DB engine version and can be named and there are restrictions as follows.

* Must be unique for each region.
* Must contains alphabets, numbers, and - _ between 1 and 100 characters, and the first character must be an alphabet.

When you create a parameter group, the parameter is always generated by default. To create based on an existing parameter group, you must create a parameter group using the copy parameter feature.

### Copy Parameter Group

You can create a new parameter group based on an existing parameter group. The copied new parameter group consists of the parameter values of the original parameter group. There is no association between the original parameter group and the copied parameter group, and changing or deleting the original parameter group does not have any effect on the copied parameter group.

### Reset Parameter Group

When you group parameters, you change the values of all parameters to the default values for the DB engine version.

<a id="apply"></a>
### Apply Parameter Group

When creating or modifying a DB instance, you can select the parameter groups to apply to the DB instance. One parameter group is applied to one DB instance, and one parameter group can be applied to multiple DB instances. If a parameter in a parameter group is changed, the change does not immediately apply to the DB instance. If an associated DB instance exists, the parameter group changes to `Need to Apply`. On the DB Instances list screen, select the DB instance associated with the parameter
group, and then click **Apply Parameter Group Changes** to reflect the changes in the parameters to the DB instance. When changes to the parameter group are applied to all associated DB instances, the parameter group changes to `Applied `.

> [Caution] If the parameters that require restart have changed, the DB instance will be restarted during applying changes.

### Compare Parameter Group

After selecting two different parameter groups in the console, click the **Compare** button to see what parameters are different. You can compare parameter groups for different DB engine versions as well as the same DB engine version.

### Delete Parameter Group

You are free to delete parameter groups except those already applied to the DB instances. To delete a parameter group already applied to a DB instance, you must first change the parameter group of all connected DB instances before you delete it.

## Parameter

The parameter contains the following information.

| Item             | Description                                                                                                                                                                                                       | 
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| 
| Group            | Option group of option file (my.cnf).                                                                                                                                                                             | 
| Name             | Option name of option file (my.cnf).<br/>When the option name and system variables are different (**_- Variable_**: Displayed additionally in the format (- Variable: `System Variables`).                        | 
| Value            | Value to be applied to parameters.                                                                                                                                                                                |
| Allowed values   | Range of values applicable to parameters.<br/>                                                                                                                                                                    | 
| Application Type | Either ` Static` or ` Dynamic`.<br/>For `Static`, the DB instance must be restarted to apply the parameter changes.<br/>For `Dynamic`, the parameters are applied immediately without restarting the DB instance. | 
| Data Format      | Format of the parameter value.                                                                                                                                                                                    | |
| Use Formula      | Whether the formula is available to use.                                                                                                                                                                          |

### Parameter Variables, Formulas, and Functions

Certain parameters may be better represented by formulas using values associated with DB instances rather than using fixed values. To support this, you can use predefined variables, formulas, and functions for `NUMERIC`, `INTEGER` data format.

* Formulas
    * You can use `()`, `+`, `-`, `*`, `/`.
    * The result of a formula must always be a number.
    * If the data type is `INTEGER`, decimals are discarded.
    * If the data type is `NUMERIC`, it is rounded to the ninth decimal place.
* Functions
    * `max(a, b, ...)`: Returns the largest of several values.
    * `min(a, b, ...)`: Returns the smallest of several values.
    * `sum([a, b, ...])`: Returns the sum of multiple values.
* Variable
    * `ramSizeByte`: Indicates the byte value of the memory size of the current DB instance type.
    * `vCPU`: Indicates the number of virtual CPU cores for the current DB instance type.
    * `dbPort`: Indicates the DB port of the current DB instance.
    * `serverId`: Indicates the server ID assigned to the current DB instance.
    * `readOnly`: Indicates `1` or `0` when the current DB instance is read-only.

Below example is the default value of `innodb_buffer_pool_size` parameter, and it indicates setting to 6/10 of the memory size of the DB instance type.

``` 
ramSizeByte * 6 / 10 
```

### Change Parameter

You can change the parameters by selecting a parameter group from the console and pressing the **Edit Parameters** button. For parameters that cannot be changed, the value appears in plain text, and for parameters that can be changed, the INPUT that can be changed appears. When you press the `Preview Changes` button on the edit screen, a separate pop-up screen will be displayed to view the changed parameters, press the `Reset` button to return to the time before the change. All changes made
in edit mode are reflected in the parameter group by pressing the `Save Changes` button. For information about reflecting DB instances of changed parameter groups, refer to the [Apply Parameter Groups](parameter-group/#apply).

## GTID 제약조건

GTID모드에서는 enforce_gtid_consistency=ON 으로 할때 다음 제약들이 적용됩니다. 참고 : [https://dev.mysql.com/doc/refman/8.4/en/replication-gtids-restrictions.html](https://dev.mysql.com/doc/refman/8.4/en/replication-gtids-restrictions.html)

### ENFORCE_GTID_CONSISTENCY

* OFF : 제약대상 쿼리 허용
* WARN : 제약대상 쿼리를 허용하지만 warning 발생
* ON : 제약대상 쿼리 허용안함

### 고객 영향도

> GTID를 이용한 복제의 아래 제한 사항에 해당 하는 쿼리를 사용 할 수 없게 됩니다 (에러가 발생합니다)

1. 비 트랜잭션 저장 엔진과 관련된 업데이트
    * MyISAM과 같은 비 트랜잭션 저장 엔진과 관련된 업데이트를 INNODB 와 같이 트랜젝션을 지원하는 저장엔진을 사용하는 업데이트와 한 트랜젝션에서 수행할 수 없습니다.
    * 소스와 복제본이 동일한 테이블이 다른 스토리지 엔진을 사용하는 경우에도 문제가 발생합니다.
    * 비 트랜잭션 테이블에서 작동하도록 정의된 트리거가 동일 유형의 문제를 일으킬 수 있습니다.
2. CREATE TABLE ... SELECT 구문
3. binlog_format이 STATEMENT 일때, 트랜잭션/프로시저/함수/트리거 내부에서 임시테이블을 생성/삭제 할 수 없습니다.

### 고객 권장 사전 조치

1. 가능하면 MyISAM과 같은 비트랜잭션 저장 엔진을 사용하지 마세요. 사용한다면 INNODB 같은 트랜젝션 저장엔진과 한 트랜젝션에서 업데이트를 수행하지 마세요.
2. CREATE TABLE ... SELECT 구문을 사용하지 마세요.
    ```
    예시)  
    create table tbl_backup as select * from tbl_ori; 
    를 다음과 같이 변형해야 합니다.
    create table tbl_backup like tbl_ori; insert tbl_backup select * from tbl_ori;
    ```



## GTID 적용단계

### gtid_mode

| 값 | Source 에서 동작 | Replica에서 동작 |
| :--- | :----------- | :----------- |
| OFF | GTID 미적용 | GTID 처리 불가 |
| OFF_PERMISSIVE | GTID 도 처리 가능 | GTID 도 처리 가능 |
| ON_PERMISSIVE | GTID 적용 | GTID 적용 |
| ON | GTID만 처리 | GTID만 처리 |

### RDS에서 GTID 적용 절차

GTID를 원활하게 적용하기 위해서, gtid_mode (gtid의 적용단계) 와 enforce_gtid_consistency(쿼리적용 제한단계) 를 파라미터 그룹을 통해 다음 순서로 적용해야 합니다.
참고 : [https://dev.mysql.com/doc/refman/8.4/en/replication-mode-change-online-enable-gtids.html](https://dev.mysql.com/doc/refman/8.4/en/replication-mode-change-online-enable-gtids.html)

| 단계 | 대상 | 파라미터 설정 | 동작 | 비고 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 모든 DB 인스턴스 | enforce_gtid_consistency = WARN | GTID적용시 문제가 되는 SQL에 warning 발생 확인. | 파라미터 그룹 변경 후 적용.<br>문제가 예상되는 SQL을 warning에서 확인하고 <br>APP에서 수정합니다.<br>더이상 warning이 발생하지 않을때까지 지속합니다. |
| 2 | 모든 DB 인스턴스 | enforce_gtid_consistency = ON | 문제가 되는 SQL에 에러 발생 | 파라미터 그룹 변경 후 적용.<br>더이상 GTID에서 문제가 되는 쿼리가 수행되지 못합니다. |
| 3 | 모든 DB 인스턴스 | gtid_mode = OFF_PERMISSIVE | Replica가 GTID를 처리할 수 있도록 준비 | 파라미터 그룹 변경 후 적용.<br>모든 Replica가 먼저 OFF_PERMISSIVE가 되어야만 문제가 발생하지 않습니다. |
| 4 | 모든 DB 인스턴스 | gtid_mode = ON_PERMISSIVE | Source가 GTID를 생성 | 파라미터 그룹 변경 후 적용. |
| 5 | 모든 DB 인스턴스 | - | 잔여 ANONYMOUS 트랜잭션 확인 | `SHOW STATUS LIKE 'ONGOING_ANONYMOUS_TRANSACTION_COUNT';`<br>모든 서버에서 결과 0이 최소 1번은 나와야 합니다. |
| 6 | 모든 DB 인스턴스 | gtid_mode = ON | 모든 트랜젝션은 GTID만 사용 | 파라미터 그룹 변경 후 적용. |

> [주의]
> * 각 단계에서 파라미터 그룹 변경 후에는 반드시 [파라미터 그룹 변경 사항 적용](parameter-group/#apply)을 수행해야 합니다.
> * gtid_mode와 enforce_gtid_consistency 파라미터 변경 시 DB 인스턴스 재시작이 필요할 수 있습니다.
> * GTID 적용해제는 적용의 역순으로 진행합니다.