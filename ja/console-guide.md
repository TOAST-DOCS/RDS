## Database > RDS for MySQL > コンソール使用ガイド

## 開始する

RDS for MysQLを使用するには、先にDBインスタンスを作成する必要があります。DBインスタンスは次の方法で作成できます。

* **Console > Database > RDS for MySQL**の **DB Instance **タブで左上の **+ 作成** ボタンをクリックすると、下図のようにページの下に入力画面が現れます。

![rds_01_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_01_201812.png)

* **詳細設定** 画面に表示された必須項目をすべて入力した後、画面右上の **次へ** ボタンをクリックします。
    * DB Instance：DBインスタンス名を入力します。
    * 説明：DBインスタンスの説明を入力します。
    * DB Engine：作成するデータベースエンジンバージョンを選択します。
    * DB Port：データベースのポート番号を入力します。 10000～12000の間で設定できます。
    * DB User ID：データベース作成時に作成される管理者アカウントIDを入力します。
    * DB Password：データベース作成時に作成される管理者アカウントパスワードを入力します。
    * VPC Subnet：作成するDBインスタンスとprivate network通信をするCompute & Networkサービスのサブネットを選択します。
    * Floating IP：TOASTクラウド外部ネットワークと接続する場合、Floating IPを使用に設定します。
    * Flavor：DBインスタンスのタイプを選択します。
    * Storage 타입: DB 인스턴스 볼륨의 타입을 지정합니다.
      * HDD 및 SSD를 선택할 수 있습니다.
    * Storage：DBインスタンスボリュームのサイズを入力します。 20GB～1,000GBのサイズで作成できます。
    * Availabillity Zone：DBインスタンスが作成される領域を選択します。
> [参考]選択したCompute & NetworkサービスのVPCサブネットがインターネットゲートウェイと接続されていない場合、Floating IPを使用できません。
> [参考]一度選択したVPCサブネットは変更できません。
> [참고] U 타입 사양의 인스턴스들은 Flavor를 변경할 수 없습니다.

**バックアップ&アクセス制御** 画面でバックアップ情報を指定します。

![rds_02_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_02_201812.png)

* 自動バックアップおよびアクセス制御を設定した後、 **次へ** ボタンをクリックします。
* バックアップ保管期間：自動バックアップをするには、1日以上を選択します。
    **なし**を選択すると、自動バックアップが行われません。
* バックアップ開始時刻：自動バックアップはバックアップ開始時刻からDurationの間の任意の時点に始まります。
    Durationはバックアップが始まる時刻を意味します。 Duration内にバックアップが終了することを意味するわけではありません。
* ユーザーアクセス制御：DBインスタンスにアクセス可能なユーザーをCIDR形式で入力します。
  ユーザーアクセス制御に登録されていないIPは接続できません。

DB Configuration画面で設定値を変更できます。

![rds_03_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_03_201812.png)

* 設定値を変更した後、 **作成** ボタンをクリックします。
* 最後に **確認** ボタンをクリックすると、DBインスタンスが作成されます。
* 作成されるまで、数分から数十分かかります。

### DBインスタンス接続

作成されたDBインスタンスを選択すると、詳細設定を確認できます。 Floating IPが接続されていないDBインスタンスは、外部からアクセスできません。

1. 外部から接続をテストするために右上の **変更** ボタンをクリックします。
2. Floating IP項目を **使用する**に修正します。
3. **確認** ボタンをクリックすると、修正事項が反映されます。

![rds_04_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_04_201812.png)

設定後、Floating IPが作成され、外部からアクセスできることを確認できます。

![rds_05_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_05_201812.png)

次はMySQL Workbenchの接続例です。

![rds_06_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_06_201812.png)

## DBインスタンス

### インスタンスタイプ

* TOAST Compute & Networkサービスで提供するすべてのタイプでDBインスタンスを作成できます。

### バックアップ

* RDSではデータボリュームサイズと同じサイズのバックアップボリュームを基本提供します。
* バックアップボリュームがいっぱいになると、古いバックアップから順にObject Storageにアップロードされます。
* Object Storageに保存されたバックアップは、容量に応じて別途料金がかかります。
* 別途料金を希望しない場合は、バックアップ周期を調整する必要があります。
* バックアップの実行中は、性能が低下することがあります。
* サービスに影響を与えないようにするには、サービスの負荷が小さい時間にバックアップを行ってください。
* TOAST RDSは時点復元をサポートします。
  バイナリログ(binary log)サイズと保管周期が短すぎる場合、希望する時点に復元するのが困難な場合があります。
* 復元中のDBインスタンスはバックアップできません。

#### 自動バックアップ

* DBインスタンスのバックアップ周期を1日以上に設定すると、自動バックアップが有効になります。
    * バックアップ周期を1日以上から、なしに変更すると、即時にすべての自動バックアップはサーバーから削除されます。
    * 削除されたバックアップは復元できません。
* 設定されたバックアップ周期分、バックアップファイルを維持します。
* 自動バックアップは、バックアップ開始時刻からDurationの間の任意の時点に始まります。
* Durationはバックアップが始まる時刻を意味します。 Duration内にバックアップが完了するということではありません。
    Duration内にバックアップを完了できなくてもバックアップは終了しません。

#### 手動バックアップ

* 自動バックアップ以外に、いつでも手動でバックアップできます。
* 手動バックアップは、すべてObject Storageに保存され、削除しない限り消えません。

### 復元

* 保管されたバックアップを利用して、希望する時点にDBインスタンスを復元できます。
* 復元時、原本DBインスタンスを変更せず、新しいDBインスタンスを作成します。
* バックアップの保存位置がObject Storageにある場合、さらに時間がかかります。
* バックアップ中のDBインスタンスを利用して復元できません。
> [参考]復元の進行中、Binary Logファイルのサイズ分、Object Storage使用量が発生することがあります。

### コピー

* 読み取り性能高めるには、MySQLがサポートするRead Only Slaveを作成します。
* Read Only Slaveを作成するには、原本DBインスタンスを選択した後、 **追加機能 > コピー作成**をクリックします。

![rds_07_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_07_201812.png)

* コピー作成のための設定を入力し、 **コピー** ボタンをクリックすると、コピーが作成されます。
* 原本DBインスタンスと同じタイプまたはさらに高いタイプでの作成を推奨します。低いタイプで作成した場合、コピー遅延が発生することがあります。
* コピー作成時、原本DBインスタンスのI/O性能が通常より低下することがあります。
* 原本DBインスタンスのサイズに比例して、コピー作成時間が増加することがあります。
> [参考]コピーの進行中、バイナリログファイルのサイズ分、Object Storage使用量が発生することがあります。

#### 制約事項

* 1つの原本インスタンスは、最大5個のコピーを作成することができます。
* コピーのコピーは作成できません。

### 昇格

* コピー関係を切り、Read Only SlaveからMasterに変更することを昇格と呼びます。
* 昇格したコピーは、原本DBインスタンスの修正事項を自動的に反映しません。
* 昇格したコピーは、独立したDBインスタンスとして動作するようになります。
* 昇格するコピーと原本DBインスタンスの間にコピー遅延がある場合、遅延がなくなるまで昇格されません。

### 容量の確保

*  DBインスタンスのリソースを削除し、ディスク容量を確保できます。

#### バイナリログ削除

![rds_08_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_08_201812.png)

* バイナリログファイルを削除してディスクスペースを確保します。

>[注意]選択した対象バイナリログファイルと、それ以前に作成されたバイナリログファイルがすべて削除されます。

### ストレージ拡張

![rds_09_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_09_201812.png)

* DBインスタンスのストレージサイズを拡張します。
* Read Only Slaveが存在する場合、Masterと同じストレージサイズに拡張されます。
* 対象DBインスタンスが再起動します。

## モニタリング

* RDSはDB運営および使用に必要なモニタリング項目を周期的に収集し、チャートで表示します。
* 特定DBインスタンスのモニタリング項目を見たい場合は、**DB Instance** リストから特定DBインスタンスを選択し、 **Monitoring** タブを選択します。

![rds_10_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_10_201812.png)

* 特定DBインスタンスのモニタリング項目を見たい場合は、**Monitoring** タブで希望するDBインスタンスを選択し、 **追加** ボタンをクリックします。
* チャート範囲、間隔、種類および項目を変更すると、変更事項が追加されたすべてのDBインスタンスに影響を与えます。

![rds_11_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_11_201812.png)

* チャートの範囲を簡単に調整できるボタンを使用できます。
* 1時間、6時間などのボタンを押すと、現在の時刻を基準に自動でfrom～toを計算してアップデートします。
<br/>
* チャート範囲よって選択できるチャート間隔が異なります。
    * 2時間以内：1分、10分
    * 12時間以内：10分、 1時間
    * 4日以内：1時間、 6時間
    * 2週以内：6時間、1日
    * それ以外：1日
* チャート種類は、最大値と平均値をサポートします。

> [参考] RDS DBインスタンス別モニタリングデータは、ユーザーDBインスタンスの'rds_maintenance'というデータベースに臨時で保存されて削除されます。したがって作成した後、何も動作していないインスタンスでも、いくつかのモニタリング項目が規則的に動くグラフ形式が現れることがあります。
> [参考] rds_maintenance databaseのデータを操作すると、正確ではないモニタリングデータが収集されることがあります。

### モニタリング項目

* RDSでサポートするモニタリング項目は次のとおりです。

![rds_12_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_12_201812.png)

### ログファイル

* DBインスタンスに接続しなくても、ログファイルの閲覧やダウンロードができます。
* **DB Instance**を選択した後、 **Events & Log** タブをクリックすると、error.log, slow_query.log, general.logファイルを閲覧できます。

![rds_13_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_13_201812.png)

* また、必ず **DB Configuration**でログを残すように設定する必要があります。
* **参照** ボタンをクリックすると、新しいウィンドウでログファイルを閲覧できます。
* ログの長さに入力されたライン数だけ閲覧でき、終わりから1MBサイズのログを閲覧できます。

![rds_14_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_14_201812.png)

* ログファイル全体を閲覧したい場合、 **ダウンロード** ボタンをクリックして直接ファイルをダウンロードする必要があります。

![rds_15_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_15_201812.png)

* **ダウンロード** ボタンをクリックすると、新しいウィンドウが表示されます。
* **取得** ボタンをクリックして少し待つと、 **ダウンロード** ボタンが有効になり、ダウンロードできるようになります。
* ログファイルは臨時Object Storageにアップロードされ、最大5分間ダウンロードできるようになります。
> [参考] Object Storageにアップロードされ、削除される5分間にObject Storage使用料金がかかることがあります。


## イベント

* RDSはDBインスタンスで発生した意味あるイベントを自動的に残します。
* 特定DBインスタンスで発生したイベントを確認したい場合、DBインスタンスを選択した後、 **詳細設定** 画面の **Event & Log** タブで確認できます。
* マイDBインスタンスで発生したイベントを一度に確認するには、 **Event** タブに移動して確認できます。

![rds_16_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_16_201812.png)

* **タイプ**は、どのリソースで発生したイベントかを指します。
    * INSTANCE：DBインスタンスに関連するイベントです。
    * BACKUP：バックアップに関連するイベントです。
* **Identifier**は、イベントが発生したリソースを指します。
    * イベントタイプがINSTANCEの場合、DBインスタンス名が表示されます。
    * イベントタイプがBACKUPの場合、バックアップIDが表示されます。

## Notification

RDSは、希望するリソースで発生する特定イベント通知を受信グループに伝達できます。

1. 希望する通知を設定するには、 **Notification** タブで **作成** ボタンをクリックします。
2. 希望する通知の名前を入力し、 **通知設定**で設定するイベントとリソースを選択します。
 設定後、 **追加** ボタンをクリックします。
3. 通知を受ける受信グループを作成するには **作成** ボタンをクリックします。
4. 수신 대상 팝업창이 뜨면 수신 그룹 이름입력 후 프로젝트에 소속된 수신 가능 프로젝트 멤버 중 Notification을 수신하고자 하는 멤버를 클릭하여 수신 대상 프로젝트 멤버로 선택합니다.
 **追加** ボタンをクリックします。
5. 受信対象ウィンドウで **作成** ボタンをクリックします。
6. 通知設定を完了した後、 **作成** ボタンをクリックします。 

![rds_17_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_17_201812.png)

設定した条件を満たすと、受信対象に入力したメールアドレスと電話番号で通知を受け取ることができます。

![rds_18_201812](https://static.toastoven.net/prod_rds/19.01.29/rds_18_201812.png)

> [参考]受信グループでチェックボックスを選択していない対象には、メール/SMSが送信されません。
