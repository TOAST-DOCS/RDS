## Database > RDS for MySQL > コンソール使用ガイド

## 開始する

RDS for MysQLを使用するには、先にDBインスタンスを作成する必要があります。DBインスタンスは次の方法で作成できます。

* **Console > Database > RDS for MySQL**の **DB Instance **タブで左上の **+ 作成** ボタンをクリックすると、下図のようにページの下に入力画面が現れます。

![rds_01_20210112](https://static.toastoven.net/prod_rds/21.01.12/rds_01_20210112_jp.png)

* **詳細設定** 画面に表示された必須項目をすべて入力した後、画面右上の **次へ** ボタンをクリックします。
    * DB Instance：DBインスタンス名を入力します。
    * 説明：DBインスタンスの説明を入力します。
    * DB Engine：作成するデータベースエンジンバージョンを選択します。
    * DB Port：データベースのポート番号を入力します。 
        * 10000～12000の間で設定できます。
    * DB User ID：データベース作成時に作成される管理者アカウントIDを入力します。
    * DB Password：データベース作成時に作成される管理者アカウントパスワードを入力します。
    * VPC Subnet：作成するDBインスタンスとprivate network通信をするCompute & Networkサービスのサブネットを選択します。
    * Floating IP：NHN Cloudクラウド外部ネットワークと接続する場合、Floating IPを使用に設定します。
    * Flavor：DBインスタンスのタイプを選択します。
    * Storageタイプ：DBインスタンスボリュームのタイプを指定します。
        * HDDおよびSSDを選択できます。
    * Storage：DBインスタンスボリュームのサイズを入力します。 
        * 20GB～2TBのサイズで作成できます。
    * Availabillity Zone：DBインスタンスが作成される領域を選択します。
    * 高可用性：DBインスタンスを作成する時、Masterとは異なるAvailability ZoneにCandidate Masterを作成します。
    * Ping Interval：高可用性使用時、 Masterインスタンスの状態を確認する時間間隔を設定します。4回失敗すると障害と判断します。
        * 1～600秒の間で設定できます。
    * DBファイルの暗号化：ユーザーデータファイルおよびバックアップファイルを暗号化します。
    * 基本アラーム：DBインスタンスのイベントのうち、定義されているイベントに対するアラームを登録できます。
        * 基本アラーム使用時、受信グループを選択する必要があります。

> [参考]選択したComputeおよびNetworkのサービスのVPCサブネットがインターネットゲートウェイと接続されていない場合、Floating IPを使用できません。
> [参考]一度選択したVPCサブネットは変更できません。
> [参考] Candidate Masterインスタンスは、必ずMasterと異なるAvailability Zoneに作成され、リストに表示されません。
> [参考]インスタンスリストは、各インスタンスの作成順にソートされ、Candidate MasterはMasterの高可用性オプション使用時点で作成されるため、フェイルオーバー後、インスタンスの順序が変わる場合があります。
> [参考] DBファイル暗号化機能を使用すると、パフォーマンスが多少低下する場合があります。
> [参考]基本アラーム使用時、該当インスタンスに対するアラームが自動的に登録され、名前は"{インスタンス名}-default"に設定されます。登録されるアラームは変更および削除することができ、適用されるインスタンスも変更できます。

**バックアップ&アクセス制御** 画面でバックアップ情報を指定します。

![backup_and_access_0_ko](https://static.toastoven.net/prod_rds/21.09.14/backup_and_access_0_ko.png)

* 自動バックアップおよびアクセス制御を設定した後、 **次へ** ボタンをクリックします。
* クエリー遅延待機時間：バックアップ遂行時にFLUSH TABLES WITH READ LOCK遅延待機時間を設定できます。 
  * 0～21600の間の値に設定できます。
* バックアップ保管期間：自動バックアップをするには、1日以上を選択します。
    **なし**を選択すると、自動バックアップが行われません。
* バックアップ開始時刻：自動バックアップはバックアップ開始時刻からDurationの間の任意の時点に始まります。
    * Durationはバックアップが始まる時刻を意味します。 
    * Duration内にバックアップが終了することを意味するわけではありません。
* テーブルロック使用：バックアップを行う時、FLUSH TABLES WITH READ LOCK構文でテーブルをロックするかどうかを設定します。
* バックアップ再試行回数：バックアップが失敗した時、再試行する回数を指定できます。
  * 1回以上を入力すると再試行を行います。
  * 自動バックアップ実行時にのみ動作します。
* バックアップ再試行終了時刻：バックアップが失敗した時、決められた回数再試行を行いますが、次のバックアップ時間に影響を与えないように設定した時間までのみ再試行を行います。
* ユーザーアクセス制御：DBインスタンスにアクセス可能なユーザーをCIDR形式で入力します。
    * ユーザーアクセス制御に登録されていないIPは接続できません。
    * アクセス制御を行う時、方向設定で`受信/送信`を許可するかどうかを選択します。

DB Configuration画面で設定値を変更できます。

![db_configuration_0_ko](https://static.toastoven.net/prod_rds/21.09.14/db_configuration_0_ko.png)

* 設定値を変更した後、 **作成** ボタンをクリックします。
* 最後に **確認** ボタンをクリックすると、DBインスタンスが作成されます。
* 作成されるまで、数分から数十分かかります。

### DBインスタンス接続

* 作成されたDBインスタンスを選択すると、詳細設定を確認できます。 
* インスタンス[詳細設定]の[接続情報]で、接続可能なドメイン情報を確認できます。
* Floating IPを‘使用’に設定していないDBインスタンスは、外部からアクセスできません。


1. 外部から接続をテストするために右上の **変更** ボタンをクリックします。
2. Floating IP項目を **使用する**に修正します。
3. **確認** ボタンをクリックすると、修正事項が反映されます。

![instance_detail_0_ko](https://static.toastoven.net/prod_rds/21.09.14/instance_detail_0_ko.png)

* 設定後、Floating IPが作成され、外部からアクセスできることを確認できます。

![instance_detail_1_ko](https://static.toastoven.net/prod_rds/21.09.14/instance_detail_1_ko.png)

* 次はMySQL Workbenchの接続例です。

![rds_06_20210112](https://static.toastoven.net/prod_rds/21.01.12/rds_06_20210112_jp.png)

#### 制約事項

* ユーザーComputeサービスのインスタンスがdnsサーバーに接続できないネットワーク環境の場合、該当インスタンスはドメインを通してRDSインスタンスに接続できません。
* ユーザーが使用中のISPで、セキュリティのためによく知られているポートをブロックすることがあります。NHN CloudのRDSに接続できない場合もあり、その場合はポート番号を変更する必要があります。

## DBインスタンス

### 高可用性

* 別のAvailability ZoneにCandidate Masterを作成しておけば、Masterに障害が発生した時、フェイルオーバーを進行させることができます。
* 高可用性インスタンスを再起動する時、[フェイルオーバーを利用した再起動]オプションを選択し、MasterとCandidate Masterを交換できます。
  * マスターが変更されるとbin logファイルが全て削除され、変更される前の時間に復元ができません。
Masterにlockがかかっていたり複製ディレイが長い場合、フェイルオーバーが行われなかったり時間が長くかかるため、トランザクションが全て終了していて、複製ディレイがないことを確認する必要があります。
* 高可用性を使用したインスタンスの場合、一部オプションを変更する時、接続情報は変わりませんが、MasterとCandidate Masterインスタンスは変わる場合があります。
* 障害が発生し、高可用性インスタンスにフェイルオーバーが実行された時、変更された新しいMasterインスタンスは、既存のMasterインスタンスのバックアップを継承しません。

> [参考]高可用性インスタンス使用時、 MySQLクエリーを使用して他のインスタンスまたは外部MySQLのMasterから強制的に複製するように設定すると、高可用性および一部機能が正常に動作しません。
> [参考] DBインスタンスのストレージ使用量がいっぱいになると、高可用性監視プロセスが障害と検知し、フェイルオーバーを実行するため注意してください。
